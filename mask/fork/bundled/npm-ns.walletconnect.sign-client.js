"use strict";
(globalThis["webpackChunkmask_network"] = globalThis["webpackChunkmask_network"] || []).push([[5058],{

/***/ 56992:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TN: () => (/* binding */ ns)
/* harmony export */ });
/* unused harmony exports ENGINE_CONTEXT, ENGINE_RPC_OPTS, HISTORY_CONTEXT, HISTORY_EVENTS, HISTORY_STORAGE_VERSION, METHODS_TO_VERIFY, PROPOSAL_CONTEXT, PROPOSAL_EXPIRY, PROPOSAL_EXPIRY_MESSAGE, REQUEST_CONTEXT, SESSION_CONTEXT, SESSION_EXPIRY, SESSION_REQUEST_EXPIRY_BOUNDARIES, SIGN_CLIENT_CONTEXT, SIGN_CLIENT_DEFAULT, SIGN_CLIENT_EVENTS, SIGN_CLIENT_PROTOCOL, SIGN_CLIENT_STORAGE_OPTIONS, SIGN_CLIENT_STORAGE_PREFIX, SIGN_CLIENT_VERSION, default */
/* harmony import */ var _walletconnect_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4355);
/* harmony import */ var _walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(28803);
/* harmony import */ var _walletconnect_logger__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _walletconnect_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(1405);
/* harmony import */ var _walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(97609);
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(58470);
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _walletconnect_time__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(24041);
/* harmony import */ var _walletconnect_time__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(35673);
const j="wc",k=2,J="client",b=`${j}@${k}:${J}:`,C={name:J,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},je={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire"},ke={database:":memory:"},Je={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Xe="history",He="0.3",ee="proposal",Fe=(/* unused pure expression or super */ null && ($e)),se="Proposal expired",te="session",A=_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.SEVEN_DAYS,ie="engine",O={wc_sessionPropose:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1104},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1106},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1112},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.THIRTY_SECONDS,prompt:!1,tag:1115}}},G={min:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,max:_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.SEVEN_DAYS},re="request",ne=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Be=Object.defineProperty,Qe=Object.defineProperties,We=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable,ae=(d,r,e)=>r in d?Be(d,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[r]=e,w=(d,r)=>{for(var e in r||(r={}))Ze.call(r,e)&&ae(d,e,r[e]);if(oe)for(var e of oe(r))es.call(r,e)&&ae(d,e,r[e]);return d},X=(d,r)=>Qe(d,We(r));class ss extends _walletconnect_types__WEBPACK_IMPORTED_MODULE_2__/* .IEngine */ .W3{constructor(r){super(r),this.name=ie,this.events=new (events__WEBPACK_IMPORTED_MODULE_4___default()),this.initialized=!1,this.ignoredPayloadTypes=[_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .TYPE_1 */ .rV],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(O)}),this.initialized=!0)},this.connect=async e=>{this.isInitialized();const s=X(w({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:t,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:a,relays:o}=s;let l=t,h,I=!1;if(l&&(I=this.client.core.pairing.pairings.get(l).active),!l||!I){const{topic:v,uri:y}=await this.client.core.pairing.create();l=v,h=y}const g=await this.client.core.crypto.generateKeyPair(),f=w({requiredNamespaces:i,optionalNamespaces:n,relays:o??[{protocol:_walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .RELAYER_DEFAULT_PROTOCOL */ .ZF}],proposer:{publicKey:g,metadata:this.client.metadata}},a&&{sessionProperties:a}),{reject:u,resolve:V,done:M}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .createDelayedPromise */ .H1)(_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES,se);if(this.events.once((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_connect"),async({error:v,session:y})=>{if(v)u(v);else if(y){y.self.publicKey=g;const H=X(w({},y),{requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces});await this.client.session.set(y.topic,H),await this.setExpiry(y.topic,y.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:y.peer.metadata}),V(H)}}),!l){const{message:v}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(v)}const L=await this.sendRequest(l,"wc_sessionPropose",f),ce=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES);return await this.setProposal(L,w({id:L,expiry:ce},f)),{uri:h,approval:M}},this.pair=async e=>(this.isInitialized(),await this.client.core.pairing.pair(e)),this.approve=async e=>{this.isInitialized(),await this.isValidApprove(e);const{id:s,relayProtocol:t,namespaces:i,sessionProperties:n}=e,a=this.client.proposal.get(s);let{pairingTopic:o,proposer:l,requiredNamespaces:h,optionalNamespaces:I}=a;o=o||"",(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidObject */ .L5)(h)||(h=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getRequiredNamespacesFromNamespaces */ .fc)(i,"approve()"));const g=await this.client.core.crypto.generateKeyPair(),f=l.publicKey,u=await this.client.core.crypto.generateSharedKey(g,f);o&&s&&(await this.client.core.pairing.updateMetadata({topic:o,metadata:l.metadata}),await this.sendResult(s,o,{relay:{protocol:t??"irn"},responderPublicKey:g}),await this.client.proposal.delete(s,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:o}));const V=w({relay:{protocol:t??"irn"},namespaces:i,requiredNamespaces:h,optionalNamespaces:I,pairingTopic:o,controller:{publicKey:g,metadata:this.client.metadata},expiry:(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(A)},n&&{sessionProperties:n});await this.client.core.relayer.subscribe(u),await this.sendRequest(u,"wc_sessionSettle",V);const M=X(w({},V),{topic:u,pairingTopic:o,acknowledged:!1,self:V.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:g});return await this.client.session.set(u,M),await this.setExpiry(u,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(A)),{topic:u,acknowledged:()=>new Promise(L=>L(this.client.session.get(u)))}},this.reject=async e=>{this.isInitialized(),await this.isValidReject(e);const{id:s,reason:t}=e,{pairingTopic:i}=this.client.proposal.get(s);i&&(await this.sendError(s,i,t),await this.client.proposal.delete(s,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")))},this.update=async e=>{this.isInitialized(),await this.isValidUpdate(e);const{topic:s,namespaces:t}=e,i=await this.sendRequest(s,"wc_sessionUpdate",{namespaces:t}),{done:n,resolve:a,reject:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .createDelayedPromise */ .H1)();return this.events.once((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_update",i),({error:l})=>{l?o(l):a()}),await this.client.session.update(s,{namespaces:t}),{acknowledged:n}},this.extend=async e=>{this.isInitialized(),await this.isValidExtend(e);const{topic:s}=e,t=await this.sendRequest(s,"wc_sessionExtend",{}),{done:i,resolve:n,reject:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .createDelayedPromise */ .H1)();return this.events.once((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_extend",t),({error:o})=>{o?a(o):n()}),await this.setExpiry(s,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(A)),{acknowledged:i}},this.request=async e=>{this.isInitialized(),await this.isValidRequest(e);const{chainId:s,request:t,topic:i,expiry:n}=e,a=await this.sendRequest(i,"wc_sessionRequest",{request:t,chainId:s},n),{done:o,resolve:l,reject:h}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .createDelayedPromise */ .H1)(n);return this.events.once((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_request",a),({error:I,result:g})=>{I?h(I):l(g)}),this.client.events.emit("session_request_sent",{topic:i,request:t,chainId:s,id:a}),await o()},this.respond=async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:s,response:t}=e,{id:i}=t;(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(t)?await this.sendResult(i,s,t.result):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(t)&&await this.sendError(i,s,t.error),this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0})},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:s}=e;if(this.client.session.keys.includes(s)){const t=await this.sendRequest(s,"wc_sessionPing",{}),{done:i,resolve:n,reject:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .createDelayedPromise */ .H1)();this.events.once((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_ping",t),({error:o})=>{o?a(o):n()}),await i()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async e=>{this.isInitialized(),await this.isValidEmit(e);const{topic:s,event:t,chainId:i}=e;await this.sendRequest(s,"wc_sessionEvent",{event:t,chainId:i})},this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:s}=e;this.client.session.keys.includes(s)?(await this.sendRequest(s,"wc_sessionDelete",(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter(s=>(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isSessionCompatible */ .Ih)(s,e))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(e,s)=>{const{self:t}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),await Promise.all([this.client.session.delete(e,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(t.publicKey),this.client.core.crypto.deleteSymKey(e),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deleteProposal=async(e,s)=>{await Promise.all([this.client.proposal.delete(e,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deletePendingSessionRequest=async(e,s,t=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,s),t?Promise.resolve():this.client.core.expirer.del(e)])},this.setExpiry=async(e,s)=>{this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:s}),this.client.core.expirer.set(e,s)},this.setProposal=async(e,s)=>{await this.client.proposal.set(e,s),this.client.core.expirer.set(e,s.expiry)},this.setPendingSessionRequest=async e=>{const s=O.wc_sessionRequest.req.ttl,{id:t,topic:i,params:n}=e;await this.client.pendingRequest.set(t,{id:t,topic:i,params:n}),s&&this.client.core.expirer.set(t,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(s))},this.sendRequest=async(e,s,t,i)=>{const n=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.formatJsonRpcRequest)(s,t);if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isBrowser */ .jU)()&&ne.includes(s)){const l=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .hashMessage */ .rj)(JSON.stringify(n));await this.client.core.verify.register({attestationId:l})}const a=await this.client.core.crypto.encode(e,n),o=O[s].req;return i&&(o.ttl=i),this.client.core.history.set(e,n),this.client.core.relayer.publish(e,a,o),n.id},this.sendResult=async(e,s,t)=>{const i=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.formatJsonRpcResult)(e,t),n=await this.client.core.crypto.encode(s,i),a=await this.client.core.history.get(s,e),o=O[a.request.method].res;this.client.core.relayer.publish(s,n,o),await this.client.core.history.resolve(i)},this.sendError=async(e,s,t)=>{const i=(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.formatJsonRpcError)(e,t),n=await this.client.core.crypto.encode(s,i),a=await this.client.core.history.get(s,e),o=O[a.request.method].res;this.client.core.relayer.publish(s,n,o),await this.client.core.history.resolve(i)},this.cleanup=async()=>{const e=[],s=[];this.client.session.getAll().forEach(t=>{(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(t.expiry)&&e.push(t.topic)}),this.client.proposal.getAll().forEach(t=>{(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(t.expiry)&&s.push(t.id)}),await Promise.all([...e.map(t=>this.deleteSession(t)),...s.map(t=>this.deleteProposal(t))])},this.onRelayEventRequest=e=>{const{topic:s,payload:t}=e,i=t.method;switch(i){case"wc_sessionPropose":return this.onSessionProposeRequest(s,t);case"wc_sessionSettle":return this.onSessionSettleRequest(s,t);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,t);case"wc_sessionExtend":return this.onSessionExtendRequest(s,t);case"wc_sessionPing":return this.onSessionPingRequest(s,t);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,t);case"wc_sessionRequest":return this.onSessionRequest(s,t);case"wc_sessionEvent":return this.onSessionEventRequest(s,t);default:return this.client.logger.info(`Unsupported request method ${i}`)}},this.onRelayEventResponse=async e=>{const{topic:s,payload:t}=e,i=(await this.client.core.history.get(s,t.id)).request.method;switch(i){case"wc_sessionPropose":return this.onSessionProposeResponse(s,t);case"wc_sessionSettle":return this.onSessionSettleResponse(s,t);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,t);case"wc_sessionExtend":return this.onSessionExtendResponse(s,t);case"wc_sessionPing":return this.onSessionPingResponse(s,t);case"wc_sessionRequest":return this.onSessionRequestResponse(s,t);default:return this.client.logger.info(`Unsupported response method ${i}`)}},this.onSessionProposeRequest=async(e,s)=>{const{params:t,id:i}=s;try{this.isValidConnect(w({},s.params));const n=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(_walletconnect_time__WEBPACK_IMPORTED_MODULE_5__.FIVE_MINUTES),a=w({id:i,pairingTopic:e,expiry:n},t);await this.setProposal(i,a);const o=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .hashMessage */ .rj)(JSON.stringify(s)),l=await this.getVerifyContext(o,a.proposer.metadata);this.client.events.emit("session_proposal",{id:i,params:a,context:l})}catch(n){await this.sendError(i,e,n),this.client.logger.error(n)}},this.onSessionProposeResponse=async(e,s)=>{const{id:t}=s;if((0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)){const{result:i}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:i});const n=this.client.proposal.get(t);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});const a=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const o=i.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});const l=await this.client.core.crypto.generateSharedKey(a,o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const h=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else (0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&(await this.client.proposal.delete(t,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidSessionSettleRequest(i);const{relay:n,controller:a,expiry:o,namespaces:l,requiredNamespaces:h,optionalNamespaces:I,sessionProperties:g,pairingTopic:f}=s.params,u=w({topic:e,relay:n,expiry:o,namespaces:l,acknowledged:!0,pairingTopic:f,requiredNamespaces:h,optionalNamespaces:I,controller:a.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},g&&{sessionProperties:g});await this.sendResult(s.id,e,!0),this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_connect"),{session:u})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.onSessionSettleResponse=async(e,s)=>{const{id:t}=s;(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_approve",t),{})):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&(await this.client.session.delete(e,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getSdkError */ .D6)("USER_DISCONNECTED")),this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_approve",t),{error:s.error}))},this.onSessionUpdateRequest=async(e,s)=>{const{params:t,id:i}=s;try{this.isValidUpdate(w({topic:e},t)),await this.client.session.update(e,{namespaces:t.namespaces}),await this.sendResult(i,e,!0),this.client.events.emit("session_update",{id:i,topic:e,params:t})}catch(n){await this.sendError(i,e,n),this.client.logger.error(n)}},this.onSessionUpdateResponse=(e,s)=>{const{id:t}=s;(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)?this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_update",t),{}):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_update",t),{error:s.error})},this.onSessionExtendRequest=async(e,s)=>{const{id:t}=s;try{this.isValidExtend({topic:e}),await this.setExpiry(e,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .calcExpiry */ .gn)(A)),await this.sendResult(t,e,!0),this.client.events.emit("session_extend",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionExtendResponse=(e,s)=>{const{id:t}=s;(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)?this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_extend",t),{}):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_extend",t),{error:s.error})},this.onSessionPingRequest=async(e,s)=>{const{id:t}=s;try{this.isValidPing({topic:e}),await this.sendResult(t,e,!0),this.client.events.emit("session_ping",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionPingResponse=(e,s)=>{const{id:t}=s;setTimeout(()=>{(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)?this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_ping",t),{}):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_ping",t),{error:s.error})},500)},this.onSessionDeleteRequest=async(e,s)=>{const{id:t}=s;try{this.isValidDisconnect({topic:e,reason:s.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(_walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .RELAYER_EVENTS */ .Mb.publish,async()=>{i(await this.deleteSession(e))})}),this.sendResult(t,e,!0)]),this.client.events.emit("session_delete",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidRequest(w({topic:e},i)),await this.setPendingSessionRequest({id:t,topic:e,params:i});const n=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .hashMessage */ .rj)(JSON.stringify(s)),a=this.client.session.get(e),o=await this.getVerifyContext(n,a.peer.metadata);this.client.events.emit("session_request",{id:t,topic:e,params:i,context:o})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.onSessionRequestResponse=(e,s)=>{const{id:t}=s;(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResult)(s)?this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_request",t),{result:s.result}):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcError)(s)&&this.events.emit((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .engineEvent */ .E0)("session_request",t),{error:s.error})},this.onSessionEventRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidEmit(w({topic:e},i)),this.client.events.emit("session_event",{id:t,topic:e,params:i})}catch(n){await this.sendError(t,e,n),this.client.logger.error(n)}},this.isValidConnect=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(o)}const{pairingTopic:s,requiredNamespaces:t,optionalNamespaces:i,sessionProperties:n,relays:a}=e;if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isUndefined */ .o8)(s)||await this.isValidPairingTopic(s),!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidRelays */ .PM)(a,!0)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`connect() relays: ${a}`);throw new Error(o)}!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isUndefined */ .o8)(t)&&(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidObject */ .L5)(t)!==0&&this.validateNamespaces(t,"requiredNamespaces"),!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isUndefined */ .o8)(i)&&(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidObject */ .L5)(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isUndefined */ .o8)(n)||this.validateSessionProps(n,"sessionProperties")},this.validateNamespaces=(e,s)=>{const t=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidRequiredNamespaces */ .n)(e,"connect()",s);if(t)throw new Error(t.message)},this.isValidApprove=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e))throw new Error((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:s,namespaces:t,relayProtocol:i,sessionProperties:n}=e;await this.isValidProposalId(s);const a=this.client.proposal.get(s),o=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespaces */ ["in"])(t,"approve()");if(o)throw new Error(o.message);const l=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isConformingNamespaces */ .rF)(a.requiredNamespaces,t,"approve()");if(l)throw new Error(l.message);if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidString */ .M_)(i,!0)){const{message:h}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isUndefined */ .o8)(n)||this.validateSessionProps(n,"sessionProperties")},this.isValidReject=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:i}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(i)}const{id:s,reason:t}=e;if(await this.isValidProposalId(s),!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidErrorReason */ .$t)(t)){const{message:i}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(t)}`);throw new Error(i)}},this.isValidSessionSettleRequest=e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:l}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:s,controller:t,namespaces:i,expiry:n}=e;if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidRelay */ .Z2)(s)){const{message:l}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidController */ .Dd)(t,"onSessionSettleRequest()");if(a)throw new Error(a.message);const o=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespaces */ ["in"])(i,"onSessionSettleRequest()");if(o)throw new Error(o.message);if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(n)){const{message:l}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(o)}const{topic:s,namespaces:t}=e;await this.isValidSessionTopic(s);const i=this.client.session.get(s),n=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespaces */ ["in"])(t,"update()");if(n)throw new Error(n.message);const a=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isConformingNamespaces */ .rF)(i.requiredNamespaces,t,"update()");if(a)throw new Error(a.message)},this.isValidExtend=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:t}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionTopic(s)},this.isValidRequest=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(o)}const{topic:s,request:t,chainId:i,expiry:n}=e;await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespacesChainId */ .p8)(a,i)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(o)}if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidRequest */ .hH)(t)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`request() ${JSON.stringify(t)}`);throw new Error(o)}if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespacesRequest */ .al)(a,i,t.method)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`request() method: ${t.method}`);throw new Error(o)}if(n&&!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidRequestExpiry */ .ON)(n,G)){const{message:o}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`request() expiry: ${n}. Expiry must be a number (in seconds) between ${G.min} and ${G.max}`);throw new Error(o)}},this.isValidRespond=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:i}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(i)}const{topic:s,response:t}=e;if(await this.isValidSessionTopic(s),!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidResponse */ .JT)(t)){const{message:i}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(t)}`);throw new Error(i)}},this.isValidPing=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:t}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(a)}const{topic:s,event:t,chainId:i}=e;await this.isValidSessionTopic(s);const{namespaces:n}=this.client.session.get(s);if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespacesChainId */ .p8)(n,i)){const{message:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidEvent */ .nf)(t)){const{message:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(t)}`);throw new Error(a)}if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidNamespacesEvent */ .sI)(n,i,t.name)){const{message:a}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(t)}`);throw new Error(a)}},this.isValidDisconnect=async e=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidParams */ .EJ)(e)){const{message:t}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(e,s)=>{const t={verified:{verifyUrl:s.verifyUrl||"",validation:"UNKNOWN",origin:s.url||""}};try{const i=await this.client.core.verify.resolve({attestationId:e,verifyUrl:s.verifyUrl});i&&(t.verified.origin=i,t.verified.validation=i===s.url?"VALID":"INVALID")}catch(i){this.client.logger.error(i)}return this.client.logger.info(`Verify context: ${JSON.stringify(t)}`),t},this.validateSessionProps=(e,s)=>{Object.values(e).forEach(t=>{if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidString */ .M_)(t,!1)){const{message:i}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(t)}`);throw new Error(i)}})}}isInitialized(){if(!this.initialized){const{message:r}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.client.core.relayer.on(_walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .RELAYER_EVENTS */ .Mb.message,async r=>{const{topic:e,message:s}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const t=await this.client.core.crypto.decode(e,s);(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcRequest)(t)?(this.client.core.history.set(e,t),this.onRelayEventRequest({topic:e,payload:t})):(0,_walletconnect_jsonrpc_utils__WEBPACK_IMPORTED_MODULE_6__.isJsonRpcResponse)(t)&&(await this.client.core.history.resolve(t),this.onRelayEventResponse({topic:e,payload:t}))})}registerExpirerEvents(){this.client.core.expirer.on(_walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .EXPIRER_EVENTS */ .i9.expired,async r=>{const{topic:e,id:s}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .parseExpirerTarget */ .iP)(r.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("EXPIRED"),!0);e?this.client.session.keys.includes(e)&&(await this.deleteSession(e,!0),this.client.events.emit("session_expire",{topic:e})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(r){if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidString */ .M_)(r,!1)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(e)}if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(this.client.core.pairing.pairings.get(r).expiry)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("EXPIRED",`pairing topic: ${r}`);throw new Error(e)}}async isValidSessionTopic(r){if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidString */ .M_)(r,!1)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(e)}if(!this.client.session.keys.includes(r)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(e)}if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("EXPIRED",`session topic: ${r}`);throw new Error(e)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidString */ .M_)(r,!1)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(e)}else{const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(e)}}async isValidProposalId(r){if(!(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isValidId */ .Q0)(r)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(e)}if(!this.client.proposal.keys.includes(r)){const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(e)}if((0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .isExpired */ .Bw)(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:e}=(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getInternalError */ .Z7)("EXPIRED",`proposal id: ${r}`);throw new Error(e)}}}class ts extends _walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .Store */ .yh{constructor(r,e){super(r,e,ee,b),this.core=r,this.logger=e}}class is extends _walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .Store */ .yh{constructor(r,e){super(r,e,te,b),this.core=r,this.logger=e}}class rs extends _walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .Store */ .yh{constructor(r,e){super(r,e,re,b,s=>s.id),this.core=r,this.logger=e}}class $ extends _walletconnect_types__WEBPACK_IMPORTED_MODULE_2__/* .ISignClient */ .lV{constructor(r){super(r),this.protocol=j,this.version=k,this.name=C.name,this.events=new events__WEBPACK_IMPORTED_MODULE_4__.EventEmitter,this.on=(s,t)=>this.events.on(s,t),this.once=(s,t)=>this.events.once(s,t),this.off=(s,t)=>this.events.off(s,t),this.removeListener=(s,t)=>this.events.removeListener(s,t),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(t){throw this.logger.error(t.message),t}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(t){throw this.logger.error(t.message),t}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(t){throw this.logger.error(t.message),t}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(t){throw this.logger.error(t.message),t}},this.update=async s=>{try{return await this.engine.update(s)}catch(t){throw this.logger.error(t.message),t}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(t){throw this.logger.error(t.message),t}},this.request=async s=>{try{return await this.engine.request(s)}catch(t){throw this.logger.error(t.message),t}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(t){throw this.logger.error(t.message),t}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(t){throw this.logger.error(t.message),t}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(t){throw this.logger.error(t.message),t}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(t){throw this.logger.error(t.message),t}},this.find=s=>{try{return this.engine.find(s)}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=r?.name||C.name,this.metadata=r?.metadata||(0,_walletconnect_utils__WEBPACK_IMPORTED_MODULE_3__/* .getAppMetadata */ .D)();const e=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:(0,_walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__.pino)((0,_walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__.getDefaultLoggerOptions)({level:r?.logger||C.logger}));this.core=r?.core||new _walletconnect_core__WEBPACK_IMPORTED_MODULE_0__/* .Core */ .QY(r),this.logger=(0,_walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__.generateChildLogger)(e,this.name),this.session=new is(this.core,this.logger),this.proposal=new ts(this.core,this.logger),this.pendingRequest=new rs(this.core,this.logger),this.engine=new ss(this)}static async init(r){const e=new $(r);return await e.initialize(),e}get context(){return (0,_walletconnect_logger__WEBPACK_IMPORTED_MODULE_1__.getLoggerContext)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}const ns=$;


/***/ })

}]);
//# sourceMappingURL=npm-ns.walletconnect.sign-client.js.map